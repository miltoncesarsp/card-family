console.log("Admin.js carregado!");

async function uploadCard() {
    console.log("Iniciando upload da carta...");

    // Capturar valores do formulário
    const name = document.getElementById("cardName").value;
    const power = document.getElementById("cardPower").value;
    const rarity = document.getElementById("cardRarity").value;
    const element = document.getElementById("cardElement").value;
    const fileInput = document.getElementById("fileInput");

    if (!name || !power || !rarity || !element) {
        alert("Preencha todos os campos!");
        return;
    }

    if (!fileInput.files.length) {
        alert("Envie uma imagem!");
        return;
    }

    const file = fileInput.files[0];

    // Nome da imagem no storage
    const fileName = `cards/${Date.now()}_${file.name}`;

    console.log("Enviando imagem:", fileName);

    // Upload para o Storage do Supabase
    const { error: uploadError } = await supabase
        .storage
        .from("cards")
        .upload(fileName, file);

    if (uploadError) {
        console.error(uploadError);
        alert("Erro ao enviar a imagem!");
        return;
    }

    console.log("Imagem enviada com sucesso!");

    // URL pública da imagem
    const { data: publicUrlData } = supabase
        .storage
        .from("cards")
        .getPublicUrl(fileName);

    const imageUrl = publicUrlData.publicUrl;

    console.log("URL pública:", imageUrl);

    // Inserir carta no banco
    const { error: insertError } = await supabase
        .from("cards")
        .insert({
            name: name,
            power: power,
            rarity: rarity,
            element: element,
            image_url: imageUrl
        });

    if (insertError) {
        console.error(insertError);
        alert("Erro ao salvar no banco!");
        return;
    }

    alert("Carta criada com sucesso!");
}
